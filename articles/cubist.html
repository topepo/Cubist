<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cubist Regresion Models • Cubist</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Cubist Regresion Models">
<meta property="og:description" content="Cubist">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Cubist</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/cubist.html">Introduction</a>
</li>
<li>
  <a href="../articles/extras/tuning.html">Tuning</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/topepo/Cubist/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Cubist Regresion Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/topepo/Cubist/blob/HEAD/vignettes/cubist.Rmd" class="external-link"><code>vignettes/cubist.Rmd</code></a></small>
      <div class="hidden name"><code>cubist.Rmd</code></div>

    </div>

    
    
<p><code>Cubist</code> is an <code>R</code> port of the Cubist GPL
<code>C</code> code released by RuleQuest at <a href="http://rulequest.com/cubist-info.html" class="external-link"><code>http://rulequest.com/cubist-info.html</code></a>.
See the last section of this document for information on the porting.
The other parts describes the functionality of the <code>R</code>
package.</p>
<div class="section level2">
<h2 id="model-trees">Model Trees<a class="anchor" aria-label="anchor" href="#model-trees"></a>
</h2>
<p>Cubist is a rule-based model that is an extension of Quinlan’s M5
model tree. A tree is grown where the terminal leaves contain linear
regression models. These models are based on the predictors used in
previous splits. Also, there are intermediate linear models at each step
of the tree. A prediction is made using the linear regression model at
the terminal node of the tree, but is “smoothed” by taking into account
the prediction from the linear model in the previous node of the tree
(which also occurs recursively up the tree). The tree is reduced to a
set of rules, which initially are paths from the top of the tree to the
bottom. Rules are eliminated via pruning and/or combined for
simplification.</p>
<p>This is explained better in Quinlan (1992). Wang and Witten (1997)
attempted to recreate this model using a “rational reconstruction” of
Quinlan (1992) that is the basis for the <code>M5P</code> model in
<code>Weka</code> (and the R package <code>RWeka</code>).</p>
<p>An example of a model tree can be illustrated using the Ames housing
data in the <code>modeldata</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://topepo.github.io/Cubist/" class="external-link">Cubist</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ames</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span></span>
<span><span class="co"># model the data on the log10 scale</span></span>
<span><span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">11</span><span class="op">)</span></span>
<span><span class="va">in_train_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">.8</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lot_Area"</span>, <span class="st">"Alley"</span>, <span class="st">"Lot_Shape"</span>, <span class="st">"Neighborhood"</span>, <span class="st">"Bldg_Type"</span>, </span>
<span>    <span class="st">"Year_Built"</span>, <span class="st">"Total_Bsmt_SF"</span>, <span class="st">"Central_Air"</span>, <span class="st">"Gr_Liv_Area"</span>, </span>
<span>    <span class="st">"Bsmt_Full_Bath"</span>, <span class="st">"Bsmt_Half_Bath"</span>, <span class="st">"Full_Bath"</span>, <span class="st">"Half_Bath"</span>, </span>
<span>    <span class="st">"TotRms_AbvGrd"</span>,  <span class="st">"Year_Sold"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train_pred</span> <span class="op">&lt;-</span> <span class="va">ames</span><span class="op">[</span> <span class="va">in_train_set</span>, <span class="va">predictors</span><span class="op">]</span></span>
<span><span class="va">test_pred</span>  <span class="op">&lt;-</span> <span class="va">ames</span><span class="op">[</span><span class="op">-</span><span class="va">in_train_set</span>, <span class="va">predictors</span><span class="op">]</span></span>
<span></span>
<span><span class="va">train_resp</span> <span class="op">&lt;-</span> <span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span><span class="op">[</span> <span class="va">in_train_set</span><span class="op">]</span></span>
<span><span class="va">test_resp</span>  <span class="op">&lt;-</span> <span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span><span class="op">[</span><span class="op">-</span><span class="va">in_train_set</span><span class="op">]</span></span>
<span></span>
<span><span class="va">model_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubist.default.html">cubist</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">train_pred</span>, y <span class="op">=</span> <span class="va">train_resp</span><span class="op">)</span></span>
<span><span class="va">model_tree</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## cubist.default(x = train_pred, y = train_resp)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of samples: 2344 </span></span>
<span><span class="co">## Number of predictors: 17 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of committees: 1 </span></span>
<span><span class="co">## Number of rules: 14</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_tree</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## cubist.default(x = train_pred, y = train_resp)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Cubist [Release 2.07 GPL Edition]  Tue Jul  2 00:59:50 2024</span></span>
<span><span class="co">## ---------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Target attribute `outcome'</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Read 2344 cases (18 attributes) from undefined.data</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1: [48 cases, mean 4.859286, range 4.106837 to 5.176091, est err 0.114526]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Old_Town, Sawyer_West, Iowa_DOT_and_Rail_Road}</span></span>
<span><span class="co">##  Year_Built &lt;= 1952</span></span>
<span><span class="co">##  Central_Air = N</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -352.195658 + 10.59 Latitude + 0.000362 Gr_Liv_Area</span></span>
<span><span class="co">##            - 0.044 Year_Sold</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2: [59 cases, mean 4.981545, range 4.594393 to 5.311754, est err 0.066423]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, Edwards, Sawyer, Brookside, Crawford,</span></span>
<span><span class="co">##                          South_and_West_of_Iowa_State_University}</span></span>
<span><span class="co">##  Year_Built &lt;= 1952</span></span>
<span><span class="co">##  Central_Air = N</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 3.738655 + 0.000281 Gr_Liv_Area + 8e-05 Total_Bsmt_SF</span></span>
<span><span class="co">##            + 0.00047 Year_Built</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 3: [333 cases, mean 5.089450, range 4.69897 to 5.676693, est err 0.063499]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Old_Town, Edwards, Gilbert, Sawyer, Sawyer_West,</span></span>
<span><span class="co">##                          Brookside, Iowa_DOT_and_Rail_Road, Timberland,</span></span>
<span><span class="co">##                          South_and_West_of_Iowa_State_University}</span></span>
<span><span class="co">##  Year_Built &lt;= 1952</span></span>
<span><span class="co">##  Central_Air = Y</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -36.367569 + 0.000242 Gr_Liv_Area + 5.9e-05 Total_Bsmt_SF</span></span>
<span><span class="co">##            + 0.00085 Year_Built + 0.94 Latitude - 0.01 TotRms_AbvGrd</span></span>
<span><span class="co">##            + 0.036 Bsmt_Half_Bath + 0.006 Bsmt_Full_Bath + 5e-07 Lot_Area</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 4: [176 cases, mean 5.137743, range 4.788875 to 5.332842, est err 0.034310]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {College_Creek, Edwards, Somerset, Northridge_Heights,</span></span>
<span><span class="co">##                          Gilbert, Sawyer_West, Mitchell, Iowa_DOT_and_Rail_Road,</span></span>
<span><span class="co">##                          Timberland, Clear_Creek, Meadow_Village, Briardale,</span></span>
<span><span class="co">##                          Blueste, Landmark}</span></span>
<span><span class="co">##  Year_Built &gt; 1952</span></span>
<span><span class="co">##  Total_Bsmt_SF &lt;= 765</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -28.661356 + 0.00333 Year_Built + 0.000188 Gr_Liv_Area</span></span>
<span><span class="co">##            + 7.4e-05 Total_Bsmt_SF + 5.6e-06 Lot_Area + 0.64 Latitude</span></span>
<span><span class="co">##            - 0.007 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 5: [35 cases, mean 5.150411, range 4.954243 to 5.361728, est err 0.050057]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, Old_Town, Sawyer, Northwest_Ames, Crawford,</span></span>
<span><span class="co">##                          Green_Hills}</span></span>
<span><span class="co">##  Year_Built &gt; 1952</span></span>
<span><span class="co">##  Total_Bsmt_SF &lt;= 765</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 87.372832 + 0.000171 Total_Bsmt_SF + 8.5e-05 Gr_Liv_Area</span></span>
<span><span class="co">##            + 0.00127 Year_Built - 2.02 Latitude + 3.8e-06 Lot_Area</span></span>
<span><span class="co">##            - 0.005 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 6: [76 cases, mean 5.157218, range 4.973128 to 5.363612, est err 0.045520]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, Crawford}</span></span>
<span><span class="co">##  Year_Built &lt;= 1952</span></span>
<span><span class="co">##  Central_Air = Y</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 141.774591 + 0.000129 Gr_Liv_Area - 3.26 Latitude</span></span>
<span><span class="co">##            + 4.2e-06 Lot_Area + 0.037 Bsmt_Full_Bath + 9e-05 Year_Built</span></span>
<span><span class="co">##            + 6e-06 Total_Bsmt_SF</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 7: [54 cases, mean 5.171031, range 4.79588 to 5.44832, est err 0.051527]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Bldg_Type in {Duplex, Twnhs}</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 2.31639 + 0.000232 Gr_Liv_Area + 0.00125 Year_Built</span></span>
<span><span class="co">##            - 0.018 TotRms_AbvGrd + 6.1e-05 Total_Bsmt_SF + 9e-07 Lot_Area</span></span>
<span><span class="co">##            + 0.01 Half_Bath + 0.007 Bsmt_Full_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 8: [473 cases, mean 5.192192, range 4.826075 to 5.509555, est err 0.037515]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, College_Creek, Old_Town, Edwards, Gilbert,</span></span>
<span><span class="co">##                          Sawyer, Northwest_Ames, Sawyer_West, Mitchell,</span></span>
<span><span class="co">##                          Brookside, Iowa_DOT_and_Rail_Road, Timberland,</span></span>
<span><span class="co">##                          Meadow_Village, Bloomington_Heights, Northpark_Villa}</span></span>
<span><span class="co">##  Total_Bsmt_SF &gt; 765</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##  Bsmt_Full_Bath &gt; 0</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 23.436857 + 0.00245 Year_Built + 0.000128 Gr_Liv_Area</span></span>
<span><span class="co">##            + 0.000103 Total_Bsmt_SF + 2.5e-06 Lot_Area + 0.015 Full_Bath</span></span>
<span><span class="co">##            + 0.25 Longitude + 0.003 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 9: [480 cases, mean 5.198712, range 4.778151 to 5.463805, est err 0.040757]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &gt; 1952</span></span>
<span><span class="co">##  Total_Bsmt_SF &gt; 765</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##  Bsmt_Full_Bath &lt;= 0</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 18.268736 + 0.000174 Gr_Liv_Area + 0.00279 Year_Built</span></span>
<span><span class="co">##            + 8.9e-05 Total_Bsmt_SF + 3.3e-06 Lot_Area</span></span>
<span><span class="co">##            - 0.011 TotRms_AbvGrd + 0.016 Bsmt_Full_Bath + 0.26 Longitude</span></span>
<span><span class="co">##            + 0.13 Latitude</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 10: [315 cases, mean 5.297982, range 4.905256 to 5.676693, est err 0.051186]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, College_Creek, Old_Town, Edwards, Gilbert,</span></span>
<span><span class="co">##                          Sawyer, Northwest_Ames, Sawyer_West, Mitchell,</span></span>
<span><span class="co">##                          Iowa_DOT_and_Rail_Road, Timberland,</span></span>
<span><span class="co">##                          South_and_West_of_Iowa_State_University,</span></span>
<span><span class="co">##                          Meadow_Village, Veenker}</span></span>
<span><span class="co">##  Bldg_Type in {OneFam, TwoFmCon, TwnhsE}</span></span>
<span><span class="co">##  Year_Built &lt;= 2004</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -28.023112 + 0.000157 Gr_Liv_Area + 0.0015 Year_Built</span></span>
<span><span class="co">##            + 8.4e-05 Total_Bsmt_SF - 0.015 TotRms_AbvGrd + 0.03 Full_Bath</span></span>
<span><span class="co">##            + 0.029 Half_Bath + 2.3e-06 Lot_Area - 0.32 Longitude</span></span>
<span><span class="co">##            + 0.015 Bsmt_Full_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 11: [161 cases, mean 5.445366, range 5.142662 to 5.872156, est err 0.052062]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Somerset, Northridge_Heights, Brookside, Crawford,</span></span>
<span><span class="co">##                          Northridge, Stone_Brook, Clear_Creek}</span></span>
<span><span class="co">##  Bldg_Type in {OneFam, TwoFmCon, TwnhsE}</span></span>
<span><span class="co">##  Year_Built &lt;= 2004</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 2.344921 + 0.000151 Gr_Liv_Area + 0.00134 Year_Built</span></span>
<span><span class="co">##            + 8.3e-05 Total_Bsmt_SF + 0.034 Bsmt_Full_Bath</span></span>
<span><span class="co">##            - 0.004 TotRms_AbvGrd + 0.007 Half_Bath + 6e-07 Lot_Area</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 12: [275 cases, mean 5.452962, range 5.136721 to 5.872156, est err 0.051166]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Somerset, Northridge_Heights, Crawford, Northridge,</span></span>
<span><span class="co">##                          Stone_Brook, Clear_Creek, Veenker, Blueste, Greens,</span></span>
<span><span class="co">##                          Green_Hills}</span></span>
<span><span class="co">##  Year_Built &gt; 1952</span></span>
<span><span class="co">##  Bsmt_Full_Bath &gt; 0</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 19.156714 + 0.000178 Gr_Liv_Area + 0.000159 Total_Bsmt_SF</span></span>
<span><span class="co">##            + 0.00176 Year_Built + 1.4e-06 Lot_Area + 0.19 Longitude</span></span>
<span><span class="co">##            + 0.007 Bsmt_Full_Bath - 0.002 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 13: [113 cases, mean 5.491452, range 5.281034 to 5.765619, est err 0.039038]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &gt; 2004</span></span>
<span><span class="co">##  Total_Bsmt_SF &lt;= 1907</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 25.674216 + 0.0097 Year_Built + 0.000152 Gr_Liv_Area</span></span>
<span><span class="co">##            + 0.000109 Total_Bsmt_SF + 0.057 Bsmt_Full_Bath</span></span>
<span><span class="co">##            + 0.68 Longitude + 0.56 Latitude</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 14: [35 cases, mean 5.602593, range 5.20412 to 5.786508, est err 0.077426]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &gt; 2004</span></span>
<span><span class="co">##  Total_Bsmt_SF &gt; 1907</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -0.069641 - 9.9e-05 Gr_Liv_Area + 0.008 Bsmt_Full_Bath</span></span>
<span><span class="co">##            + 0.14 Latitude + 0.001 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Evaluation on training data (2344 cases):</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Average  |error|           0.053913</span></span>
<span><span class="co">##     Relative |error|               0.39</span></span>
<span><span class="co">##     Correlation coefficient        0.90</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Attribute usage:</span></span>
<span><span class="co">##    Conds  Model</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     80%    97%    Year_Built</span></span>
<span><span class="co">##     76%   100%    Gr_Liv_Area</span></span>
<span><span class="co">##     74%           Neighborhood</span></span>
<span><span class="co">##     50%    97%    Total_Bsmt_SF</span></span>
<span><span class="co">##     47%    70%    Bsmt_Full_Bath</span></span>
<span><span class="co">##     20%           Bldg_Type</span></span>
<span><span class="co">##     20%           Central_Air</span></span>
<span><span class="co">##            90%    Lot_Area</span></span>
<span><span class="co">##            89%    TotRms_AbvGrd</span></span>
<span><span class="co">##            63%    Longitude</span></span>
<span><span class="co">##            49%    Latitude</span></span>
<span><span class="co">##            30%    Full_Bath</span></span>
<span><span class="co">##            20%    Half_Bath</span></span>
<span><span class="co">##            13%    Bsmt_Half_Bath</span></span>
<span><span class="co">##             2%    Year_Sold</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Time: 0.1 secs</span></span></code></pre>
<p>There is no formula method for <code><a href="../reference/cubist.default.html">cubist()</a></code>; the predictors
are specified as matrix or data frame, The outcome is a numeric
vector.</p>
<p>There is a predict method for the model:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_tree_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_tree</span>, <span class="va">test_pred</span><span class="op">)</span></span>
<span><span class="co">## Test set RMSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">model_tree_pred</span> <span class="op">-</span> <span class="va">test_resp</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.0751</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Test set R^2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">model_tree_pred</span>, <span class="va">test_resp</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.82</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="ensembles-by-committees">Ensembles By Committees<a class="anchor" aria-label="anchor" href="#ensembles-by-committees"></a>
</h2>
<p>The Cubist model can also use a boosting-like scheme called
<em>committees</em> where iterative model trees are created in sequence.
The first tree follows the procedure described in the last section.
Subsequent trees are created using adjusted versions to the training set
outcome: if the model over-predicted a value, the response is adjusted
downward for the next model (and so on, see <a href="https://rviews.rstudio.com/2020/05/21/modern-rule-based-models" class="external-link">this
blog post</a>). Unlike traditional boosting, stage weights for each
committee are not used to average the predictions from each model tree;
the final prediction is a simple average of the predictions from each
model tree.</p>
<p>The <code>committee</code> option can be used to control number of
model trees:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">com_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cubist.default.html">cubist</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">train_pred</span>, y <span class="op">=</span> <span class="va">train_resp</span>, committees <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">com_model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## cubist.default(x = train_pred, y = train_resp, committees = 3)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Cubist [Release 2.07 GPL Edition]  Tue Jul  2 00:59:50 2024</span></span>
<span><span class="co">## ---------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Target attribute `outcome'</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Read 2344 cases (18 attributes) from undefined.data</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model 1:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/1: [48 cases, mean 4.859286, range 4.106837 to 5.176091, est err 0.114526]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Old_Town, Sawyer_West, Iowa_DOT_and_Rail_Road}</span></span>
<span><span class="co">##  Year_Built &lt;= 1952</span></span>
<span><span class="co">##  Central_Air = N</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -352.195658 + 10.59 Latitude + 0.000362 Gr_Liv_Area</span></span>
<span><span class="co">##            - 0.044 Year_Sold</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/2: [59 cases, mean 4.981545, range 4.594393 to 5.311754, est err 0.066423]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, Edwards, Sawyer, Brookside, Crawford,</span></span>
<span><span class="co">##                          South_and_West_of_Iowa_State_University}</span></span>
<span><span class="co">##  Year_Built &lt;= 1952</span></span>
<span><span class="co">##  Central_Air = N</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 3.738655 + 0.000281 Gr_Liv_Area + 8e-05 Total_Bsmt_SF</span></span>
<span><span class="co">##            + 0.00047 Year_Built</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/3: [333 cases, mean 5.089450, range 4.69897 to 5.676693, est err 0.063499]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Old_Town, Edwards, Gilbert, Sawyer, Sawyer_West,</span></span>
<span><span class="co">##                          Brookside, Iowa_DOT_and_Rail_Road, Timberland,</span></span>
<span><span class="co">##                          South_and_West_of_Iowa_State_University}</span></span>
<span><span class="co">##  Year_Built &lt;= 1952</span></span>
<span><span class="co">##  Central_Air = Y</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -36.367569 + 0.000242 Gr_Liv_Area + 5.9e-05 Total_Bsmt_SF</span></span>
<span><span class="co">##            + 0.00085 Year_Built + 0.94 Latitude - 0.01 TotRms_AbvGrd</span></span>
<span><span class="co">##            + 0.036 Bsmt_Half_Bath + 0.006 Bsmt_Full_Bath + 5e-07 Lot_Area</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/4: [176 cases, mean 5.137743, range 4.788875 to 5.332842, est err 0.034310]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {College_Creek, Edwards, Somerset, Northridge_Heights,</span></span>
<span><span class="co">##                          Gilbert, Sawyer_West, Mitchell, Iowa_DOT_and_Rail_Road,</span></span>
<span><span class="co">##                          Timberland, Clear_Creek, Meadow_Village, Briardale,</span></span>
<span><span class="co">##                          Blueste, Landmark}</span></span>
<span><span class="co">##  Year_Built &gt; 1952</span></span>
<span><span class="co">##  Total_Bsmt_SF &lt;= 765</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -28.661356 + 0.00333 Year_Built + 0.000188 Gr_Liv_Area</span></span>
<span><span class="co">##            + 7.4e-05 Total_Bsmt_SF + 5.6e-06 Lot_Area + 0.64 Latitude</span></span>
<span><span class="co">##            - 0.007 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/5: [35 cases, mean 5.150411, range 4.954243 to 5.361728, est err 0.050057]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, Old_Town, Sawyer, Northwest_Ames, Crawford,</span></span>
<span><span class="co">##                          Green_Hills}</span></span>
<span><span class="co">##  Year_Built &gt; 1952</span></span>
<span><span class="co">##  Total_Bsmt_SF &lt;= 765</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 87.372832 + 0.000171 Total_Bsmt_SF + 8.5e-05 Gr_Liv_Area</span></span>
<span><span class="co">##            + 0.00127 Year_Built - 2.02 Latitude + 3.8e-06 Lot_Area</span></span>
<span><span class="co">##            - 0.005 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/6: [76 cases, mean 5.157218, range 4.973128 to 5.363612, est err 0.045520]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, Crawford}</span></span>
<span><span class="co">##  Year_Built &lt;= 1952</span></span>
<span><span class="co">##  Central_Air = Y</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 141.774591 + 0.000129 Gr_Liv_Area - 3.26 Latitude</span></span>
<span><span class="co">##            + 4.2e-06 Lot_Area + 0.037 Bsmt_Full_Bath + 9e-05 Year_Built</span></span>
<span><span class="co">##            + 6e-06 Total_Bsmt_SF</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/7: [54 cases, mean 5.171031, range 4.79588 to 5.44832, est err 0.051527]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Bldg_Type in {Duplex, Twnhs}</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 2.31639 + 0.000232 Gr_Liv_Area + 0.00125 Year_Built</span></span>
<span><span class="co">##            - 0.018 TotRms_AbvGrd + 6.1e-05 Total_Bsmt_SF + 9e-07 Lot_Area</span></span>
<span><span class="co">##            + 0.01 Half_Bath + 0.007 Bsmt_Full_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/8: [473 cases, mean 5.192192, range 4.826075 to 5.509555, est err 0.037515]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, College_Creek, Old_Town, Edwards, Gilbert,</span></span>
<span><span class="co">##                          Sawyer, Northwest_Ames, Sawyer_West, Mitchell,</span></span>
<span><span class="co">##                          Brookside, Iowa_DOT_and_Rail_Road, Timberland,</span></span>
<span><span class="co">##                          Meadow_Village, Bloomington_Heights, Northpark_Villa}</span></span>
<span><span class="co">##  Total_Bsmt_SF &gt; 765</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##  Bsmt_Full_Bath &gt; 0</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 23.436857 + 0.00245 Year_Built + 0.000128 Gr_Liv_Area</span></span>
<span><span class="co">##            + 0.000103 Total_Bsmt_SF + 2.5e-06 Lot_Area + 0.015 Full_Bath</span></span>
<span><span class="co">##            + 0.25 Longitude + 0.003 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/9: [480 cases, mean 5.198712, range 4.778151 to 5.463805, est err 0.040757]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &gt; 1952</span></span>
<span><span class="co">##  Total_Bsmt_SF &gt; 765</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##  Bsmt_Full_Bath &lt;= 0</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 18.268736 + 0.000174 Gr_Liv_Area + 0.00279 Year_Built</span></span>
<span><span class="co">##            + 8.9e-05 Total_Bsmt_SF + 3.3e-06 Lot_Area</span></span>
<span><span class="co">##            - 0.011 TotRms_AbvGrd + 0.016 Bsmt_Full_Bath + 0.26 Longitude</span></span>
<span><span class="co">##            + 0.13 Latitude</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/10: [315 cases, mean 5.297982, range 4.905256 to 5.676693, est err 0.051186]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, College_Creek, Old_Town, Edwards, Gilbert,</span></span>
<span><span class="co">##                          Sawyer, Northwest_Ames, Sawyer_West, Mitchell,</span></span>
<span><span class="co">##                          Iowa_DOT_and_Rail_Road, Timberland,</span></span>
<span><span class="co">##                          South_and_West_of_Iowa_State_University,</span></span>
<span><span class="co">##                          Meadow_Village, Veenker}</span></span>
<span><span class="co">##  Bldg_Type in {OneFam, TwoFmCon, TwnhsE}</span></span>
<span><span class="co">##  Year_Built &lt;= 2004</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -28.023112 + 0.000157 Gr_Liv_Area + 0.0015 Year_Built</span></span>
<span><span class="co">##            + 8.4e-05 Total_Bsmt_SF - 0.015 TotRms_AbvGrd + 0.03 Full_Bath</span></span>
<span><span class="co">##            + 0.029 Half_Bath + 2.3e-06 Lot_Area - 0.32 Longitude</span></span>
<span><span class="co">##            + 0.015 Bsmt_Full_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/11: [161 cases, mean 5.445366, range 5.142662 to 5.872156, est err 0.052062]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Somerset, Northridge_Heights, Brookside, Crawford,</span></span>
<span><span class="co">##                          Northridge, Stone_Brook, Clear_Creek}</span></span>
<span><span class="co">##  Bldg_Type in {OneFam, TwoFmCon, TwnhsE}</span></span>
<span><span class="co">##  Year_Built &lt;= 2004</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 2.344921 + 0.000151 Gr_Liv_Area + 0.00134 Year_Built</span></span>
<span><span class="co">##            + 8.3e-05 Total_Bsmt_SF + 0.034 Bsmt_Full_Bath</span></span>
<span><span class="co">##            - 0.004 TotRms_AbvGrd + 0.007 Half_Bath + 6e-07 Lot_Area</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/12: [275 cases, mean 5.452962, range 5.136721 to 5.872156, est err 0.051166]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Somerset, Northridge_Heights, Crawford, Northridge,</span></span>
<span><span class="co">##                          Stone_Brook, Clear_Creek, Veenker, Blueste, Greens,</span></span>
<span><span class="co">##                          Green_Hills}</span></span>
<span><span class="co">##  Year_Built &gt; 1952</span></span>
<span><span class="co">##  Bsmt_Full_Bath &gt; 0</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 19.156714 + 0.000178 Gr_Liv_Area + 0.000159 Total_Bsmt_SF</span></span>
<span><span class="co">##            + 0.00176 Year_Built + 1.4e-06 Lot_Area + 0.19 Longitude</span></span>
<span><span class="co">##            + 0.007 Bsmt_Full_Bath - 0.002 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/13: [113 cases, mean 5.491452, range 5.281034 to 5.765619, est err 0.039038]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &gt; 2004</span></span>
<span><span class="co">##  Total_Bsmt_SF &lt;= 1907</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 25.674216 + 0.0097 Year_Built + 0.000152 Gr_Liv_Area</span></span>
<span><span class="co">##            + 0.000109 Total_Bsmt_SF + 0.057 Bsmt_Full_Bath</span></span>
<span><span class="co">##            + 0.68 Longitude + 0.56 Latitude</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1/14: [35 cases, mean 5.602593, range 5.20412 to 5.786508, est err 0.077426]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &gt; 2004</span></span>
<span><span class="co">##  Total_Bsmt_SF &gt; 1907</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -0.069641 - 9.9e-05 Gr_Liv_Area + 0.008 Bsmt_Full_Bath</span></span>
<span><span class="co">##            + 0.14 Latitude + 0.001 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model 2:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2/1: [66 cases, mean 4.924712, range 4.106837 to 5.266937, est err 0.114951]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Central_Air = N</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 2035</span></span>
<span><span class="co">##  Longitude &gt; -93.62571</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -580.059188 + 13.91 Latitude + 0.000299 Gr_Liv_Area</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2/2: [144 cases, mean 4.960665, range 4.106837 to 5.311754, est err 0.099679]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Central_Air = N</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 2035</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 66.952321 + 0.000172 Gr_Liv_Area + 0.000122 Total_Bsmt_SF</span></span>
<span><span class="co">##            - 0.031 Year_Sold</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2/3: [314 cases, mean 5.090793, range 4.69897 to 5.676693, est err 0.062296]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Old_Town, Edwards, Gilbert, Sawyer_West,</span></span>
<span><span class="co">##                          Iowa_DOT_and_Rail_Road,</span></span>
<span><span class="co">##                          South_and_West_of_Iowa_State_University,</span></span>
<span><span class="co">##                          Meadow_Village, Briardale, Northpark_Villa}</span></span>
<span><span class="co">##  Year_Built &lt;= 1968</span></span>
<span><span class="co">##  Central_Air = Y</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -67.722399 + 0.000207 Gr_Liv_Area - 0.01 TotRms_AbvGrd</span></span>
<span><span class="co">##            + 0.78 Latitude + 0.024 Bsmt_Full_Bath - 0.42 Longitude</span></span>
<span><span class="co">##            + 0.00024 Year_Built + 1.2e-05 Total_Bsmt_SF + 6e-07 Lot_Area</span></span>
<span><span class="co">##            + 0.012 Bsmt_Half_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2/4: [86 cases, mean 5.111280, range 4.788875 to 5.311754, est err 0.075818]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Bldg_Type = Duplex</span></span>
<span><span class="co">##  Year_Built &lt;= 1990</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 3.017972 + 0.000162 Gr_Liv_Area + 0.0009 Year_Built</span></span>
<span><span class="co">##            + 4.9e-05 Total_Bsmt_SF + 0.034 Bsmt_Full_Bath</span></span>
<span><span class="co">##            - 0.011 TotRms_AbvGrd + 2.3e-06 Lot_Area</span></span>
<span><span class="co">##            + 0.049 Bsmt_Half_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2/5: [116 cases, mean 5.121052, range 4.851258 to 5.50515, est err 0.041412]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Old_Town, Edwards, Gilbert, Sawyer_West,</span></span>
<span><span class="co">##                          Iowa_DOT_and_Rail_Road,</span></span>
<span><span class="co">##                          South_and_West_of_Iowa_State_University,</span></span>
<span><span class="co">##                          Meadow_Village, Briardale, Northpark_Villa}</span></span>
<span><span class="co">##  Year_Built &gt; 1968</span></span>
<span><span class="co">##  Year_Built &lt;= 1990</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -112.72999 + 0.00697 Year_Built + 0.000177 Gr_Liv_Area</span></span>
<span><span class="co">##            + 0.000109 Total_Bsmt_SF - 0.74 Longitude + 0.82 Latitude</span></span>
<span><span class="co">##            - 0.002 TotRms_AbvGrd + 0.005 Bsmt_Full_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2/6: [1037 cases, mean 5.200723, range 4.594393 to 5.676693, est err 0.047478]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, College_Creek, Sawyer, Northwest_Ames,</span></span>
<span><span class="co">##                          Mitchell, Brookside, Timberland, Blueste}</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -11.037934 + 0.000128 Gr_Liv_Area + 8e-05 Total_Bsmt_SF</span></span>
<span><span class="co">##            + 0.00095 Year_Built + 0.032 Bsmt_Full_Bath + 0.022 Full_Bath</span></span>
<span><span class="co">##            + 0.046 Bsmt_Half_Bath + 1e-06 Lot_Area + 0.01 Half_Bath</span></span>
<span><span class="co">##            - 0.15 Longitude</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2/7: [265 cases, mean 5.260237, range 5.069113 to 5.449479, est err 0.025156]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &gt; 1990</span></span>
<span><span class="co">##  Total_Bsmt_SF &lt;= 952</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 2035</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -0.65428 + 0.000208 Gr_Liv_Area + 0.00279 Year_Built</span></span>
<span><span class="co">##            + 0.03 Bsmt_Full_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2/8: [141 cases, mean 5.292914, range 4.955928 to 5.585461, est err 0.064230]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Crawford, Stone_Brook, Clear_Creek, Veenker, Greens,</span></span>
<span><span class="co">##                          Green_Hills}</span></span>
<span><span class="co">##  Year_Built &lt;= 1990</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -13.943719 + 0.000192 Gr_Liv_Area + 0.00106 Year_Built</span></span>
<span><span class="co">##            + 3.3e-05 Total_Bsmt_SF - 0.023 Full_Bath</span></span>
<span><span class="co">##            + 0.019 Bsmt_Full_Bath + 0.026 Bsmt_Half_Bath</span></span>
<span><span class="co">##            - 0.004 TotRms_AbvGrd + 0.012 Half_Bath + 9e-07 Lot_Area</span></span>
<span><span class="co">##            - 0.18 Longitude</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2/9: [133 cases, mean 5.323634, range 4.79588 to 5.676693, est err 0.094539]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, Old_Town, Edwards, Gilbert, Sawyer,</span></span>
<span><span class="co">##                          Northwest_Ames, Sawyer_West, Mitchell, Brookside,</span></span>
<span><span class="co">##                          Iowa_DOT_and_Rail_Road,</span></span>
<span><span class="co">##                          South_and_West_of_Iowa_State_University, Clear_Creek,</span></span>
<span><span class="co">##                          Meadow_Village, Veenker}</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 2035</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -114.880871 + 2.8 Latitude + 0.00119 Year_Built</span></span>
<span><span class="co">##            + 0.048 Full_Bath + 1.1e-05 Gr_Liv_Area + 8e-06 Total_Bsmt_SF</span></span>
<span><span class="co">##            + 0.006 Bsmt_Full_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2/10: [457 cases, mean 5.357634, range 4.926857 to 5.672098, est err 0.043722]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &gt; 1990</span></span>
<span><span class="co">##  Total_Bsmt_SF &gt; 952</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 2035</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 31.082771 + 0.00743 Year_Built + 0.000272 Gr_Liv_Area</span></span>
<span><span class="co">##            + 0.000144 Total_Bsmt_SF + 0.059 Bsmt_Full_Bath</span></span>
<span><span class="co">##            - 0.015 TotRms_AbvGrd + 3.9e-06 Lot_Area + 0.44 Longitude</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2/11: [82 cases, mean 5.482795, range 5.281034 to 5.872156, est err 0.050959]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {College_Creek, Somerset, Northridge_Heights, Crawford,</span></span>
<span><span class="co">##                          Timberland, Northridge, Stone_Brook}</span></span>
<span><span class="co">##  Year_Built &lt;= 2002</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 2035</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -1.964556 + 0.000126 Gr_Liv_Area + 3.8e-06 Lot_Area</span></span>
<span><span class="co">##            + 0.00018 Year_Built + 0.16 Latitude + 0.004 Bsmt_Full_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2/12: [78 cases, mean 5.585224, range 5.380211 to 5.788875, est err 0.048668]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {College_Creek, Somerset, Northridge_Heights, Crawford,</span></span>
<span><span class="co">##                          Timberland, Northridge, Stone_Brook}</span></span>
<span><span class="co">##  Year_Built &gt; 2002</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 2035</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 137.506637 + 0.01229 Year_Built + 9.6e-05 Gr_Liv_Area</span></span>
<span><span class="co">##            + 1.91 Longitude + 0.000107 Total_Bsmt_SF</span></span>
<span><span class="co">##            + 0.044 Bsmt_Full_Bath + 0.52 Latitude + 9e-07 Lot_Area</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model 3:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 3/1: [33 cases, mean 4.765631, range 4.106837 to 5.041393, est err 0.159903]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Central_Air = N</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 845</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -391.954369 + 0.000768 Gr_Liv_Area - 4.23 Longitude</span></span>
<span><span class="co">##            + 7e-05 Year_Built</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 3/2: [104 cases, mean 4.928864, range 4.106837 to 5.175802, est err 0.091334]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 845</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -1.229338 + 0.000359 Total_Bsmt_SF + 2.31e-05 Lot_Area</span></span>
<span><span class="co">##            + 0.00297 Year_Built + 5.1e-05 Gr_Liv_Area</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 3/3: [215 cases, mean 5.123382, range 4.740363 to 5.44832, est err 0.057230]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Bldg_Type in {TwoFmCon, Duplex, Twnhs}</span></span>
<span><span class="co">##  Year_Built &lt;= 2005</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 845</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 41.243192 + 0.000147 Gr_Liv_Area + 0.00201 Year_Built</span></span>
<span><span class="co">##            + 0.056 Bsmt_Full_Bath + 0.48 Longitude</span></span>
<span><span class="co">##            + 2.6e-05 Total_Bsmt_SF - 0.006 TotRms_AbvGrd + 8e-07 Lot_Area</span></span>
<span><span class="co">##            + 0.11 Latitude + 0.004 Half_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 3/4: [248 cases, mean 5.136273, range 4.79588 to 5.676693, est err 0.074758]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &lt;= 1951</span></span>
<span><span class="co">##  Total_Bsmt_SF &gt; 800</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 845</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 4.685451 + 0.000248 Gr_Liv_Area + 0.114 Half_Bath</span></span>
<span><span class="co">##            - 0.029 TotRms_AbvGrd + 5e-06 Lot_Area + 0.0001 Year_Built</span></span>
<span><span class="co">##            + 6e-06 Total_Bsmt_SF</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 3/5: [438 cases, mean 5.150761, range 4.60206 to 5.580925, est err 0.057916]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Bldg_Type in {OneFam, TwnhsE}</span></span>
<span><span class="co">##  Total_Bsmt_SF &lt;= 800</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 845</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 2.032241 + 0.000165 Gr_Liv_Area + 0.000116 Total_Bsmt_SF</span></span>
<span><span class="co">##            + 0.00142 Year_Built + 0.033 Full_Bath - 0.003 TotRms_AbvGrd</span></span>
<span><span class="co">##            + 0.008 Bsmt_Full_Bath + 6e-07 Lot_Area + 0.006 Half_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 3/6: [1358 cases, mean 5.252755, range 4.117271 to 5.872156, est err 0.042818]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Bldg_Type in {OneFam, TwnhsE}</span></span>
<span><span class="co">##  Year_Built &gt; 1951</span></span>
<span><span class="co">##  Year_Built &lt;= 2005</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 40.010365 + 0.000187 Gr_Liv_Area + 0.00307 Year_Built</span></span>
<span><span class="co">##            + 9.9e-05 Total_Bsmt_SF + 0.038 Bsmt_Full_Bath</span></span>
<span><span class="co">##            - 0.011 TotRms_AbvGrd + 2.5e-06 Lot_Area + 0.44 Longitude</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 3/7: [235 cases, mean 5.400186, range 4.926857 to 5.765619, est err 0.047093]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &gt; 2005</span></span>
<span><span class="co">##  Total_Bsmt_SF &lt;= 2006</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -3.631741 + 0.00424 Year_Built + 0.000131 Gr_Liv_Area</span></span>
<span><span class="co">##            + 0.000125 Total_Bsmt_SF + 0.075 Bsmt_Full_Bath</span></span>
<span><span class="co">##            + 5.4e-06 Lot_Area + 0.011 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 3/8: [20 cases, mean 5.583736, range 5.20412 to 5.786508, est err 0.103229]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &gt; 2005</span></span>
<span><span class="co">##  Total_Bsmt_SF &gt; 2006</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 4.772929 - 0.000158 Gr_Liv_Area + 0.00059 Year_Built</span></span>
<span><span class="co">##            + 0.002 TotRms_AbvGrd + 4e-06 Total_Bsmt_SF</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Evaluation on training data (2344 cases):</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Average  |error|           0.051966</span></span>
<span><span class="co">##     Relative |error|               0.38</span></span>
<span><span class="co">##     Correlation coefficient        0.91</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Attribute usage:</span></span>
<span><span class="co">##    Conds  Model</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     70%    96%    Year_Built</span></span>
<span><span class="co">##     52%   100%    Gr_Liv_Area</span></span>
<span><span class="co">##     47%           Neighborhood</span></span>
<span><span class="co">##     36%    94%    Total_Bsmt_SF</span></span>
<span><span class="co">##     32%           Bldg_Type</span></span>
<span><span class="co">##     15%    83%    Bsmt_Full_Bath</span></span>
<span><span class="co">##     13%           Central_Air</span></span>
<span><span class="co">##            66%    Longitude</span></span>
<span><span class="co">##            87%    Lot_Area</span></span>
<span><span class="co">##            73%    TotRms_AbvGrd</span></span>
<span><span class="co">##            32%    Half_Bath</span></span>
<span><span class="co">##            31%    Full_Bath</span></span>
<span><span class="co">##            28%    Latitude</span></span>
<span><span class="co">##            23%    Bsmt_Half_Bath</span></span>
<span><span class="co">##             2%    Year_Sold</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Time: 0.1 secs</span></span></code></pre>
<p>For this model:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">com_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">com_model</span>, <span class="va">test_pred</span><span class="op">)</span></span>
<span><span class="co">## RMSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">com_pred</span> <span class="op">-</span> <span class="va">test_resp</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.0708</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## R^2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">com_pred</span>, <span class="va">test_resp</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.839</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="instance-based-corrections">Instance-Based Corrections<a class="anchor" aria-label="anchor" href="#instance-based-corrections"></a>
</h2>
<p>Another innovation in Cubist using nearest-neighbors to adjust the
predictions from the rule-based model. First, a model tree (with or
without committees) is created. Once a sample is predicted by this
model, Cubist can find it’s nearest neighbors and determine the average
of these training set points. See Quinlan (1993a) for the details of the
adjustment as well as <a href="https://rviews.rstudio.com/2020/05/21/modern-rule-based-models" class="external-link">this
blog post</a>.</p>
<p>The development of rules and committees is independent of the choice
of using instances. The original <code>C</code> code allowed the program
to choose whether to use instances, not use them or let the program
decide. Our approach is to build a model with the <code><a href="../reference/cubist.default.html">cubist()</a></code>
function that is ignorant to the decision about instances. When samples
are predicted, the argument <code>neighbors</code> can be used to adjust
the rule-based model predictions (or not).</p>
<p>We can add instances to the previously fit committee model:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inst_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">com_model</span>, <span class="va">test_pred</span>, neighbors <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">## RMSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">inst_pred</span> <span class="op">-</span> <span class="va">test_resp</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.0688</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## R^2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">inst_pred</span>, <span class="va">test_resp</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.848</span></span></code></pre>
<p>Note that the previous models used the implicit default of
<code>neighbors = 0</code> for their predictions.</p>
<p>It may also be useful to see how the different models fit a single
predictor. Here is the test set data for a model with one predictor
(<code>Gr_Liv_Area</code>), 100 committees, and various values of
<code>neighbors</code>:</p>
<p><img src="neighbors.gif" style="display: block; margin: auto;"></p>
<p>After the initial use of the instance-based correction, there is very
little change in the mainstream of the data.</p>
</div>
<div class="section level2">
<h2 id="model-tuning">Model tuning<a class="anchor" aria-label="anchor" href="#model-tuning"></a>
</h2>
<p>R modeling packages such as <code>caret</code>,
<code>tidymodels</code>, and <code>mlr3</code> can be used to tune the
model. See the <a href="https://topepo.github.io/Cubist/articles/extras/tuning.html" class="external-link">examples
here</a> for more details.</p>
<p>It should be noted that this variable importance measure does not
capture the influence of the predictors when using the instance-based
correction.</p>
</div>
<div class="section level2">
<h2 id="extracting-rules">Extracting Rules<a class="anchor" aria-label="anchor" href="#extracting-rules"></a>
</h2>
<p>Rules from a Cubist model can be viewed using <code>summary</code> as
follows:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_tree</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## cubist.default(x = train_pred, y = train_resp)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Cubist [Release 2.07 GPL Edition]  Tue Jul  2 00:59:50 2024</span></span>
<span><span class="co">## ---------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Target attribute `outcome'</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Read 2344 cases (18 attributes) from undefined.data</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 1: [48 cases, mean 4.859286, range 4.106837 to 5.176091, est err 0.114526]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Old_Town, Sawyer_West, Iowa_DOT_and_Rail_Road}</span></span>
<span><span class="co">##  Year_Built &lt;= 1952</span></span>
<span><span class="co">##  Central_Air = N</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -352.195658 + 10.59 Latitude + 0.000362 Gr_Liv_Area</span></span>
<span><span class="co">##            - 0.044 Year_Sold</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 2: [59 cases, mean 4.981545, range 4.594393 to 5.311754, est err 0.066423]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, Edwards, Sawyer, Brookside, Crawford,</span></span>
<span><span class="co">##                          South_and_West_of_Iowa_State_University}</span></span>
<span><span class="co">##  Year_Built &lt;= 1952</span></span>
<span><span class="co">##  Central_Air = N</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 3.738655 + 0.000281 Gr_Liv_Area + 8e-05 Total_Bsmt_SF</span></span>
<span><span class="co">##            + 0.00047 Year_Built</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 3: [333 cases, mean 5.089450, range 4.69897 to 5.676693, est err 0.063499]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Old_Town, Edwards, Gilbert, Sawyer, Sawyer_West,</span></span>
<span><span class="co">##                          Brookside, Iowa_DOT_and_Rail_Road, Timberland,</span></span>
<span><span class="co">##                          South_and_West_of_Iowa_State_University}</span></span>
<span><span class="co">##  Year_Built &lt;= 1952</span></span>
<span><span class="co">##  Central_Air = Y</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -36.367569 + 0.000242 Gr_Liv_Area + 5.9e-05 Total_Bsmt_SF</span></span>
<span><span class="co">##            + 0.00085 Year_Built + 0.94 Latitude - 0.01 TotRms_AbvGrd</span></span>
<span><span class="co">##            + 0.036 Bsmt_Half_Bath + 0.006 Bsmt_Full_Bath + 5e-07 Lot_Area</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 4: [176 cases, mean 5.137743, range 4.788875 to 5.332842, est err 0.034310]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {College_Creek, Edwards, Somerset, Northridge_Heights,</span></span>
<span><span class="co">##                          Gilbert, Sawyer_West, Mitchell, Iowa_DOT_and_Rail_Road,</span></span>
<span><span class="co">##                          Timberland, Clear_Creek, Meadow_Village, Briardale,</span></span>
<span><span class="co">##                          Blueste, Landmark}</span></span>
<span><span class="co">##  Year_Built &gt; 1952</span></span>
<span><span class="co">##  Total_Bsmt_SF &lt;= 765</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -28.661356 + 0.00333 Year_Built + 0.000188 Gr_Liv_Area</span></span>
<span><span class="co">##            + 7.4e-05 Total_Bsmt_SF + 5.6e-06 Lot_Area + 0.64 Latitude</span></span>
<span><span class="co">##            - 0.007 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 5: [35 cases, mean 5.150411, range 4.954243 to 5.361728, est err 0.050057]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, Old_Town, Sawyer, Northwest_Ames, Crawford,</span></span>
<span><span class="co">##                          Green_Hills}</span></span>
<span><span class="co">##  Year_Built &gt; 1952</span></span>
<span><span class="co">##  Total_Bsmt_SF &lt;= 765</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 87.372832 + 0.000171 Total_Bsmt_SF + 8.5e-05 Gr_Liv_Area</span></span>
<span><span class="co">##            + 0.00127 Year_Built - 2.02 Latitude + 3.8e-06 Lot_Area</span></span>
<span><span class="co">##            - 0.005 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 6: [76 cases, mean 5.157218, range 4.973128 to 5.363612, est err 0.045520]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, Crawford}</span></span>
<span><span class="co">##  Year_Built &lt;= 1952</span></span>
<span><span class="co">##  Central_Air = Y</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 141.774591 + 0.000129 Gr_Liv_Area - 3.26 Latitude</span></span>
<span><span class="co">##            + 4.2e-06 Lot_Area + 0.037 Bsmt_Full_Bath + 9e-05 Year_Built</span></span>
<span><span class="co">##            + 6e-06 Total_Bsmt_SF</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 7: [54 cases, mean 5.171031, range 4.79588 to 5.44832, est err 0.051527]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Bldg_Type in {Duplex, Twnhs}</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 2.31639 + 0.000232 Gr_Liv_Area + 0.00125 Year_Built</span></span>
<span><span class="co">##            - 0.018 TotRms_AbvGrd + 6.1e-05 Total_Bsmt_SF + 9e-07 Lot_Area</span></span>
<span><span class="co">##            + 0.01 Half_Bath + 0.007 Bsmt_Full_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 8: [473 cases, mean 5.192192, range 4.826075 to 5.509555, est err 0.037515]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, College_Creek, Old_Town, Edwards, Gilbert,</span></span>
<span><span class="co">##                          Sawyer, Northwest_Ames, Sawyer_West, Mitchell,</span></span>
<span><span class="co">##                          Brookside, Iowa_DOT_and_Rail_Road, Timberland,</span></span>
<span><span class="co">##                          Meadow_Village, Bloomington_Heights, Northpark_Villa}</span></span>
<span><span class="co">##  Total_Bsmt_SF &gt; 765</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##  Bsmt_Full_Bath &gt; 0</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 23.436857 + 0.00245 Year_Built + 0.000128 Gr_Liv_Area</span></span>
<span><span class="co">##            + 0.000103 Total_Bsmt_SF + 2.5e-06 Lot_Area + 0.015 Full_Bath</span></span>
<span><span class="co">##            + 0.25 Longitude + 0.003 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 9: [480 cases, mean 5.198712, range 4.778151 to 5.463805, est err 0.040757]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &gt; 1952</span></span>
<span><span class="co">##  Total_Bsmt_SF &gt; 765</span></span>
<span><span class="co">##  Gr_Liv_Area &lt;= 1692</span></span>
<span><span class="co">##  Bsmt_Full_Bath &lt;= 0</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 18.268736 + 0.000174 Gr_Liv_Area + 0.00279 Year_Built</span></span>
<span><span class="co">##            + 8.9e-05 Total_Bsmt_SF + 3.3e-06 Lot_Area</span></span>
<span><span class="co">##            - 0.011 TotRms_AbvGrd + 0.016 Bsmt_Full_Bath + 0.26 Longitude</span></span>
<span><span class="co">##            + 0.13 Latitude</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 10: [315 cases, mean 5.297982, range 4.905256 to 5.676693, est err 0.051186]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {North_Ames, College_Creek, Old_Town, Edwards, Gilbert,</span></span>
<span><span class="co">##                          Sawyer, Northwest_Ames, Sawyer_West, Mitchell,</span></span>
<span><span class="co">##                          Iowa_DOT_and_Rail_Road, Timberland,</span></span>
<span><span class="co">##                          South_and_West_of_Iowa_State_University,</span></span>
<span><span class="co">##                          Meadow_Village, Veenker}</span></span>
<span><span class="co">##  Bldg_Type in {OneFam, TwoFmCon, TwnhsE}</span></span>
<span><span class="co">##  Year_Built &lt;= 2004</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -28.023112 + 0.000157 Gr_Liv_Area + 0.0015 Year_Built</span></span>
<span><span class="co">##            + 8.4e-05 Total_Bsmt_SF - 0.015 TotRms_AbvGrd + 0.03 Full_Bath</span></span>
<span><span class="co">##            + 0.029 Half_Bath + 2.3e-06 Lot_Area - 0.32 Longitude</span></span>
<span><span class="co">##            + 0.015 Bsmt_Full_Bath</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 11: [161 cases, mean 5.445366, range 5.142662 to 5.872156, est err 0.052062]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Somerset, Northridge_Heights, Brookside, Crawford,</span></span>
<span><span class="co">##                          Northridge, Stone_Brook, Clear_Creek}</span></span>
<span><span class="co">##  Bldg_Type in {OneFam, TwoFmCon, TwnhsE}</span></span>
<span><span class="co">##  Year_Built &lt;= 2004</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 2.344921 + 0.000151 Gr_Liv_Area + 0.00134 Year_Built</span></span>
<span><span class="co">##            + 8.3e-05 Total_Bsmt_SF + 0.034 Bsmt_Full_Bath</span></span>
<span><span class="co">##            - 0.004 TotRms_AbvGrd + 0.007 Half_Bath + 6e-07 Lot_Area</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 12: [275 cases, mean 5.452962, range 5.136721 to 5.872156, est err 0.051166]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Neighborhood in {Somerset, Northridge_Heights, Crawford, Northridge,</span></span>
<span><span class="co">##                          Stone_Brook, Clear_Creek, Veenker, Blueste, Greens,</span></span>
<span><span class="co">##                          Green_Hills}</span></span>
<span><span class="co">##  Year_Built &gt; 1952</span></span>
<span><span class="co">##  Bsmt_Full_Bath &gt; 0</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 19.156714 + 0.000178 Gr_Liv_Area + 0.000159 Total_Bsmt_SF</span></span>
<span><span class="co">##            + 0.00176 Year_Built + 1.4e-06 Lot_Area + 0.19 Longitude</span></span>
<span><span class="co">##            + 0.007 Bsmt_Full_Bath - 0.002 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 13: [113 cases, mean 5.491452, range 5.281034 to 5.765619, est err 0.039038]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &gt; 2004</span></span>
<span><span class="co">##  Total_Bsmt_SF &lt;= 1907</span></span>
<span><span class="co">##  Gr_Liv_Area &gt; 1692</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = 25.674216 + 0.0097 Year_Built + 0.000152 Gr_Liv_Area</span></span>
<span><span class="co">##            + 0.000109 Total_Bsmt_SF + 0.057 Bsmt_Full_Bath</span></span>
<span><span class="co">##            + 0.68 Longitude + 0.56 Latitude</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Rule 14: [35 cases, mean 5.602593, range 5.20412 to 5.786508, est err 0.077426]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     if</span></span>
<span><span class="co">##  Year_Built &gt; 2004</span></span>
<span><span class="co">##  Total_Bsmt_SF &gt; 1907</span></span>
<span><span class="co">##     then</span></span>
<span><span class="co">##  outcome = -0.069641 - 9.9e-05 Gr_Liv_Area + 0.008 Bsmt_Full_Bath</span></span>
<span><span class="co">##            + 0.14 Latitude + 0.001 TotRms_AbvGrd</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Evaluation on training data (2344 cases):</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Average  |error|           0.053913</span></span>
<span><span class="co">##     Relative |error|               0.39</span></span>
<span><span class="co">##     Correlation coefficient        0.90</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Attribute usage:</span></span>
<span><span class="co">##    Conds  Model</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     80%    97%    Year_Built</span></span>
<span><span class="co">##     76%   100%    Gr_Liv_Area</span></span>
<span><span class="co">##     74%           Neighborhood</span></span>
<span><span class="co">##     50%    97%    Total_Bsmt_SF</span></span>
<span><span class="co">##     47%    70%    Bsmt_Full_Bath</span></span>
<span><span class="co">##     20%           Bldg_Type</span></span>
<span><span class="co">##     20%           Central_Air</span></span>
<span><span class="co">##            90%    Lot_Area</span></span>
<span><span class="co">##            89%    TotRms_AbvGrd</span></span>
<span><span class="co">##            63%    Longitude</span></span>
<span><span class="co">##            49%    Latitude</span></span>
<span><span class="co">##            30%    Full_Bath</span></span>
<span><span class="co">##            20%    Half_Bath</span></span>
<span><span class="co">##            13%    Bsmt_Half_Bath</span></span>
<span><span class="co">##             2%    Year_Sold</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Time: 0.1 secs</span></span></code></pre>
<p>The <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code> function in the <a href="https://rules.tidymodels.org" class="external-link"><code>rules</code> package</a>
returns rules in a tibble (an extension of data frames) with one row per
rule. The tibble provides information about the rule and can be used to
programatically extra data from the model. For example:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/rules" class="external-link">rules</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">rule_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">model_tree</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rule_df</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 14 × 5</span></span></span>
<span><span class="co">##    committee rule_num rule                                    estimate statistic</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>         1        1 ( Central_Air == 'N' ) &amp; ( Neighborhoo… <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>         1        2 ( Central_Air == 'N' ) &amp; ( Neighborhoo… <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>         1        3 ( Year_Built &lt;= 1952 ) &amp; ( Central_Air… <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>         1        4 ( Total_Bsmt_SF &lt;= 765 ) &amp; ( Year_Buil… <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>         1        5 ( Total_Bsmt_SF &lt;= 765 ) &amp; ( Neighborh… <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>         1        6 ( Neighborhood  %in% c( 'North_Ames','… <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>         1        7 ( Bldg_Type  %in% c( 'Duplex','Twnhs' … <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>         1        8 ( Bsmt_Full_Bath &gt; 0 ) &amp; ( Gr_Liv_Area… <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>         1        9 ( Bsmt_Full_Bath &lt;= 0 ) &amp; ( Gr_Liv_Are… <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>         1       10 ( Gr_Liv_Area &gt; 1692 ) &amp; ( Neighborhoo… <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span>         1       11 ( Neighborhood  %in% c( 'Somerset','No… <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span>         1       12 ( Neighborhood  %in% c( 'Somerset','No… <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">13</span>         1       13 ( Year_Built &gt; 2004 ) &amp; ( Gr_Liv_Area … <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">14</span>         1       14 ( Total_Bsmt_SF &gt; 1907 ) &amp; ( Year_Buil… <span style="color: #949494;">&lt;tibble&gt;</span> <span style="color: #949494;">&lt;tibble&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rule_df</span><span class="op">$</span><span class="va">estimate</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">##   term           estimate</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> (Intercept) -<span style="color: #BB0000;">352.</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Gr_Liv_Area    0.000<span style="text-decoration: underline;">362</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Year_Sold     -<span style="color: #BB0000;">0.044</span>   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Latitude      10.6</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rule_df</span><span class="op">$</span><span class="va">statistic</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">##   num_conditions coverage  mean   min   max error</span></span>
<span><span class="co">##            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>              4       48  4.86  4.11  5.18 0.115</span></span></code></pre>
<p>The <code>rule</code> column can be converted to an R expression that
can be used to pull data used by that rule. For example, for the seventh
rule:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Text</span></span>
<span><span class="va">rule_7</span> <span class="op">&lt;-</span> <span class="va">rule_df</span><span class="op">$</span><span class="va">rule</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Convert to an expression</span></span>
<span><span class="va">rule_7</span> <span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/parse_expr.html" class="external-link">parse_expr</a></span><span class="op">(</span><span class="va">rule_7</span><span class="op">)</span></span>
<span><span class="va">rule_7</span></span></code></pre></div>
<pre><code><span><span class="co">## (Bldg_Type %in% c("Duplex", "Twnhs")) &amp; (Gr_Liv_Area &gt; 1692)</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use in a dplyr filter: </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">train_pred</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2344</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">train_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">rule_7</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 54</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="variable-importance">Variable Importance<a class="anchor" aria-label="anchor" href="#variable-importance"></a>
</h2>
<p>The <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method for Cubist shows the usage of each
variable in either the rule conditions or the (terminal) linear model.
In actuality, many more linear models are used in prediction that are
shown in the output. Because of this, the variable usage statistics
shown at the end of the output of the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function
will probably be inconsistent with the rules also shown in the output.
At each split of the tree, Cubist saves a linear model (after feature
selection) that is allowed to have terms for each variable used in the
current split or any split above it. Quinlan (1992) discusses a
smoothing algorithm where each model prediction is a linear combination
of the parent and child model along the tree. As such, the final
prediction is a function of all the linear models from the initial node
to the terminal node. The percentages shown in the Cubist output
reflects all the models involved in prediction (as opposed to the
terminal models shown in the output).</p>
<p>The raw usage statistics are contained in a data frame called
<code>usage</code> in the <code>cubist</code> object.</p>
<p>The <code>caret</code> and <code>vip</code> packages have general
variable importance functions <code><a href="https://rdrr.io/pkg/caret/man/varImp.html" class="external-link">caret::varImp()</a></code> and
<code>vip::vi()</code>. When using this function on a
<code>cubist</code> argument, the variable importance is a linear
combination of the usage in the rule conditions and the model.</p>
<p>For example, to compute the scores:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/varImp.html" class="external-link">varImp</a></span><span class="op">(</span><span class="va">model_tree</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># or </span></span>
<span></span>
<span><span class="fu">vip</span><span class="fu">::</span><span class="fu">vi</span><span class="op">(</span><span class="va">model_tree</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exporting-the-model-using-the-rulequest-file-format">Exporting the Model Using the RuleQuest file format<a class="anchor" aria-label="anchor" href="#exporting-the-model-using-the-rulequest-file-format"></a>
</h2>
<p>As previously mentioned, this code is a port of the command-line
<code>C</code> code. To run the <code>C</code> code, the training set
data must be converted to a specific file format as detailed on the
RuleQuest website. Two files are created. The <code>file.data</code>
file is a header-less, comma delimited version of the data (the
<code>file</code> part is a name given by the user). The
<code>file.names</code> file provides information about the columns (eg.
levels for categorical data and so on). After running the <code>C</code>
program, another text file called <code>file.models</code>, which
contains the information needed for prediction.</p>
<p>Once a model has been built with the <code>R</code>
<code>cubist</code> package, the <code>exportCubistFiles</code> can be
used to create the <code>.data</code>, <code>.names</code> and
<code>.model</code> files so that the same model can be run at the
command-line.</p>
</div>
<div class="section level2">
<h2 id="current-limitations">Current Limitations<a class="anchor" aria-label="anchor" href="#current-limitations"></a>
</h2>
<p>There are a few features in the <code>C</code> code that are not yet
operational in the <code>R</code> package:</p>
<ul>
<li>only continuous and categorical predictors can be used (the original
source code allows for other data types)</li>
<li>there is an option to let the <code>C</code> code decide on using
instances or not. The choice is more explicit in this package</li>
<li>non-standard predictor names are not currently checked/fixed</li>
<li>the <code>C</code> code supports binning of predictors</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Max Kuhn, Ross Quinlan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
