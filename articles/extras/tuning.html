<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tuning Cubist Models • Cubist</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<meta property="og:title" content="Tuning Cubist Models">
<meta property="og:description" content="Cubist">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">Cubist</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../articles/cubist.html">Introduction</a>
</li>
<li>
  <a href="../../articles/extras/tuning.html">Tuning</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/topepo/Cubist/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="tuning_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tuning Cubist Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/topepo/Cubist/blob/HEAD/vignettes/extras/tuning.Rmd" class="external-link"><code>vignettes/extras/tuning.Rmd</code></a></small>
      <div class="hidden name"><code>tuning.Rmd</code></div>

    </div>

    
    
<p>The main two parameters for this model are the number of committees as well as the number of neighbors (if any) to use to adjust the model predictions. We’ll use two different packages for model tuning. Each will split and resample the data with different code. Their results will be very similar but will not be equal.</p>
<p>Before starting, we’ll use the Ames housing data again.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ames</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span>
<span class="co"># model the data on the log10 scale</span>
<span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span><span class="op">)</span>

<span class="va">predictors</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lot_Area"</span>, <span class="st">"Alley"</span>, <span class="st">"Lot_Shape"</span>, <span class="st">"Neighborhood"</span>, <span class="st">"Bldg_Type"</span>, 
    <span class="st">"Year_Built"</span>, <span class="st">"Total_Bsmt_SF"</span>, <span class="st">"Central_Air"</span>, <span class="st">"Gr_Liv_Area"</span>, 
    <span class="st">"Bsmt_Full_Bath"</span>, <span class="st">"Bsmt_Half_Bath"</span>, <span class="st">"Full_Bath"</span>, <span class="st">"Half_Bath"</span>, 
    <span class="st">"TotRms_AbvGrd"</span>,  <span class="st">"Year_Sold"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span>
<span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span><span class="op">)</span>

<span class="va">ames</span> <span class="op">&lt;-</span> <span class="va">ames</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sale_Price"</span>, <span class="va">predictors</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<div class="section level2">
<h2 id="model-tuning-via-caret">Model Tuning via caret<a class="anchor" aria-label="anchor" href="#model-tuning-via-caret"></a>
</h2>
<p>To tune the model over different values of <code>neighbors</code> and <code>committees</code>, the <code>train</code> function in the <a href="https://CRAN.R-project.org/package=caret" class="external-link"><code>caret</code></a> package can be used to optimize these parameters. For example, to split the data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">in_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html" class="external-link">createDataPartition</a></span><span class="op">(</span><span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span>, times <span class="op">=</span> <span class="fl">1</span>, list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">caret_train</span> <span class="op">&lt;-</span> <span class="va">ames</span><span class="op">[</span> <span class="va">in_train</span>,<span class="op">]</span>
<span class="va">caret_test</span>  <span class="op">&lt;-</span> <span class="va">ames</span><span class="op">[</span><span class="op">-</span><span class="va">in_train</span>,<span class="op">]</span></code></pre></div>
<p>We’ll use basic 10-fold cross-validation to tune the models over the two parameters. Although <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train()</a></code> can make its own grid, we’ll use a regular grid with four values per parameter:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>committees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>, neighbors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">caret_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">caret_train</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">Sale_Price</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="va">caret_train</span><span class="op">$</span><span class="va">Sale_Price</span>,
  method <span class="op">=</span> <span class="st">"cubist"</span>,
  tuneGrid <span class="op">=</span> <span class="va">grid</span>,
  trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">caret_grid</span></code></pre></div>
<pre><code><span class="co">## Cubist </span>
<span class="co">## </span>
<span class="co">## 1466 samples</span>
<span class="co">##   17 predictor</span>
<span class="co">## </span>
<span class="co">## No pre-processing</span>
<span class="co">## Resampling: Cross-Validated (10 fold) </span>
<span class="co">## Summary of sample sizes: 1320, 1320, 1318, 1321, 1319, 1318, ... </span>
<span class="co">## Resampling results across tuning parameters:</span>
<span class="co">## </span>
<span class="co">##   committees  neighbors  RMSE         Rsquared   MAE        </span>
<span class="co">##     1         0          0.006980097  0.7823656  0.004445466</span>
<span class="co">##     1         1          0.007736511  0.7607675  0.004892528</span>
<span class="co">##     1         5          0.006725394  0.8022236  0.004216278</span>
<span class="co">##     1         9          0.006618399  0.8077642  0.004161582</span>
<span class="co">##    10         0          0.006554084  0.8089811  0.004105507</span>
<span class="co">##    10         1          0.007649352  0.7658593  0.004737154</span>
<span class="co">##    10         5          0.006505652  0.8154348  0.004058009</span>
<span class="co">##    10         9          0.006394992  0.8208995  0.004005872</span>
<span class="co">##    50         0          0.006419605  0.8170101  0.004032752</span>
<span class="co">##    50         1          0.007574183  0.7703286  0.004686879</span>
<span class="co">##    50         5          0.006387367  0.8218289  0.003998214</span>
<span class="co">##    50         9          0.006276516  0.8272191  0.003941817</span>
<span class="co">##   100         0          0.006381553  0.8191074  0.004008798</span>
<span class="co">##   100         1          0.007566783  0.7703920  0.004680454</span>
<span class="co">##   100         5          0.006357572  0.8232121  0.003983422</span>
<span class="co">##   100         9          0.006243052  0.8288578  0.003926840</span>
<span class="co">## </span>
<span class="co">## RMSE was used to select the optimal model using the smallest value.</span>
<span class="co">## The final values used for the model were committees = 100 and neighbors = 9.</span></code></pre>
<p>Note that the x/y interface was used. This keeps factor predictors intact; if the formula method had been used, factor predictors like <code>Neighborhood</code> would have been converted to binary indicator columns. That would not cause an error, but Cubist usually works better without the indicators columns.</p>
<p>The next figure shows the profiles of the tuning parameters produced using <code>ggplot(caret_grid)</code>.</p>
<p><img src="tuning_files/figure-html/plot-tune-1.png" width="700"></p>
<p>The <code>caret_grid</code> object selected and fit the final model (with the best results). The test data are predicted using:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">caret_grid</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">caret_test</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.7239910 0.7271985 0.7235518 0.7224333 0.7280025 0.7244288</span></code></pre>
</div>
<div class="section level2">
<h2 id="model-tuning-via-tidymodels">Model Tuning via tidymodels<a class="anchor" aria-label="anchor" href="#model-tuning-via-tidymodels"></a>
</h2>
<p>The tidymodels packages have a slightly different approach to package development. Whereas <code>caret</code> contains a large number of functions, tidymodels splits the code into small packages that do a few common tasks (e.g. resampling, performance estimation). To start, load the <code>tidymodels</code> package and this will attach the main set of core packages:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Registered S3 method overwritten by 'tune':</span>
<span class="co">##   method                   from   </span>
<span class="co">##   required_pkgs.model_spec parsnip</span></code></pre>
<pre><code><span class="co">## ── <span style="font-weight: bold;">Attaching packages</span> ────────────────────────────────────── tidymodels 0.1.4 ──</span></code></pre>
<pre><code><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">broom       </span> 0.7.12     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">rsample     </span> 0.1.1 </span>
<span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dials       </span> 0.1.0      <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble      </span> 3.1.6 </span>
<span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr       </span> 1.0.7      <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr       </span> 1.2.0 </span>
<span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">infer       </span> 1.0.0      <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tune        </span> 0.1.6 </span>
<span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">modeldata   </span> 0.1.1      <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">workflows   </span> 0.2.4 </span>
<span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">parsnip     </span> 0.1.7      <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">workflowsets</span> 0.1.0 </span>
<span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr       </span> 0.3.4      <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">yardstick   </span> 0.0.9 </span>
<span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">recipes     </span> 0.1.17</span></code></pre>
<pre><code><span class="co">## ── <span style="font-weight: bold;">Conflicts</span> ───────────────────────────────────────── tidymodels_conflicts() ──</span>
<span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">purrr</span>::<span style="color: #00BB00;">discard()</span>         masks <span style="color: #0000BB;">scales</span>::discard()</span>
<span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span>          masks <span style="color: #0000BB;">stats</span>::filter()</span>
<span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>             masks <span style="color: #0000BB;">stats</span>::lag()</span>
<span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">purrr</span>::<span style="color: #00BB00;">lift()</span>            masks <span style="color: #0000BB;">caret</span>::lift()</span>
<span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">yardstick</span>::<span style="color: #00BB00;">precision()</span>   masks <span style="color: #0000BB;">caret</span>::precision()</span>
<span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">yardstick</span>::<span style="color: #00BB00;">recall()</span>      masks <span style="color: #0000BB;">caret</span>::recall()</span>
<span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">yardstick</span>::<span style="color: #00BB00;">sensitivity()</span> masks <span style="color: #0000BB;">caret</span>::sensitivity()</span>
<span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">yardstick</span>::<span style="color: #00BB00;">specificity()</span> masks <span style="color: #0000BB;">caret</span>::specificity()</span>
<span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">recipes</span>::<span style="color: #00BB00;">step()</span>          masks <span style="color: #0000BB;">stats</span>::step()</span>
<span class="co">## <span style="color: #0000BB;">•</span> Use <span style="color: #00BB00;">tidymodels_prefer()</span> to resolve common conflicts.</span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html" class="external-link">tidymodels_prefer</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><code><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html" class="external-link">tidymodels_prefer()</a></code> resolves the naming conflicts between it and <code>caret</code> functions. For example, invoking <code>sensitivity</code> will now point towards the tidymodels version (but the other function can be used via <code><a href="https://rdrr.io/pkg/caret/man/sensitivity.html" class="external-link">caret::sensitivity()</a></code>).</p>
<p>If you are new to tidymodels, we suggest taking a look at <a href="https://www.tidymodels.org/" class="external-link"><code>tidymodels.org</code></a> or the book <a href="https://www.tmwr.org/" class="external-link"><em>Tidy Modeling with R</em></a>.</p>
<p>We’ll split the data into training and test data sets, then use the <code>vfold_cv()</code> function to create cross-validation folds. There are stored in a tibble object( basically a data frame):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
<span class="va">split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">ames</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span>
<span class="va">tm_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">split</span><span class="op">)</span>
<span class="va">tm_test</span>  <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">split</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>
<span class="va">cv_folds</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">tm_train</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span>
<span class="va">cv_folds</span></code></pre></div>
<pre><code><span class="co">## #  10-fold cross-validation using stratification </span>
<span class="co">## <span style="color: #949494;"># A tibble: 10 × 2</span></span>
<span class="co">##    splits             id    </span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold01</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold02</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold03</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold04</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">&lt;split [1977/220]&gt;</span> Fold05</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">&lt;split [1977/220]&gt;</span> Fold06</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">&lt;split [1978/219]&gt;</span> Fold07</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">&lt;split [1978/219]&gt;</span> Fold08</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">&lt;split [1979/218]&gt;</span> Fold09</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">&lt;split [1980/217]&gt;</span> Fold10</span></code></pre>
<p>To use this model, we define the <em>model specification object</em> and tag which parameters that we want to tune for this model (with a value of <code>tune()</code>). the package that contains the model functions for rule-based models is called <code>rules</code>; we load that first.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/rules" class="external-link">rules</a></span><span class="op">)</span>

<span class="va">cubist_spec</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rules.tidymodels.org/reference/cubist_rules.html" class="external-link">cubist_rules</a></span><span class="op">(</span>committees <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, neighbors <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"Cubist"</span><span class="op">)</span>
<span class="va">cubist_spec</span></code></pre></div>
<pre><code><span class="co">## Cubist Model Specification (regression)</span>
<span class="co">## </span>
<span class="co">## Main Arguments:</span>
<span class="co">##   committees = tune()</span>
<span class="co">##   neighbors = tune()</span>
<span class="co">## </span>
<span class="co">## Computational engine: Cubist</span></code></pre>
<p>Now we can use the <code>tune_grid()</code> function to estimate performance for all of the parameters in the <code>grid</code> data frame:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tm_grid</span> <span class="op">&lt;-</span> 
  <span class="va">cubist_spec</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">tune_grid</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, resamples <span class="op">=</span> <span class="va">cv_folds</span>, grid <span class="op">=</span> <span class="va">grid</span><span class="op">)</span>
<span class="va">tm_grid</span></code></pre></div>
<pre><code><span class="co">## # Tuning results</span>
<span class="co">## # 10-fold cross-validation using stratification </span>
<span class="co">## <span style="color: #949494;"># A tibble: 10 × 4</span></span>
<span class="co">##    splits             id     .metrics          .notes          </span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold01 <span style="color: #949494;">&lt;tibble [32 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 1]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold02 <span style="color: #949494;">&lt;tibble [32 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 1]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold03 <span style="color: #949494;">&lt;tibble [32 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 1]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold04 <span style="color: #949494;">&lt;tibble [32 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 1]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">&lt;split [1977/220]&gt;</span> Fold05 <span style="color: #949494;">&lt;tibble [32 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 1]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">&lt;split [1977/220]&gt;</span> Fold06 <span style="color: #949494;">&lt;tibble [32 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 1]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">&lt;split [1978/219]&gt;</span> Fold07 <span style="color: #949494;">&lt;tibble [32 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 1]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">&lt;split [1978/219]&gt;</span> Fold08 <span style="color: #949494;">&lt;tibble [32 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 1]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">&lt;split [1979/218]&gt;</span> Fold09 <span style="color: #949494;">&lt;tibble [32 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 1]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">&lt;split [1980/217]&gt;</span> Fold10 <span style="color: #949494;">&lt;tibble [32 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 1]&gt;</span></span></code></pre>
<p>The results can be sown as a table or a plot:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">collect_metrics</span><span class="op">(</span><span class="va">tm_grid</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 32 × 8</span></span>
<span class="co">##    committees neighbors .metric .estimator    mean     n  std_err .config       </span>
<span class="co">##         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>          1         0 rmse    standard   0.007<span style="text-decoration: underline;">00</span>    10 0.000<span style="text-decoration: underline;">425</span> Preprocessor1…</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>          1         0 rsq     standard   0.778      10 0.022<span style="text-decoration: underline;">4</span>   Preprocessor1…</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>          1         1 rmse    standard   0.007<span style="text-decoration: underline;">76</span>    10 0.000<span style="text-decoration: underline;">404</span> Preprocessor1…</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>          1         1 rsq     standard   0.744      10 0.020<span style="text-decoration: underline;">2</span>   Preprocessor1…</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>          1         5 rmse    standard   0.006<span style="text-decoration: underline;">68</span>    10 0.000<span style="text-decoration: underline;">403</span> Preprocessor1…</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>          1         5 rsq     standard   0.799      10 0.021<span style="text-decoration: underline;">0</span>   Preprocessor1…</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>          1         9 rmse    standard   0.006<span style="text-decoration: underline;">66</span>    10 0.000<span style="text-decoration: underline;">410</span> Preprocessor1…</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>          1         9 rsq     standard   0.800      10 0.021<span style="text-decoration: underline;">3</span>   Preprocessor1…</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>         10         0 rmse    standard   0.006<span style="text-decoration: underline;">25</span>    10 0.000<span style="text-decoration: underline;">371</span> Preprocessor1…</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>         10         0 rsq     standard   0.823      10 0.019<span style="text-decoration: underline;">8</span>   Preprocessor1…</span>
<span class="co">## <span style="color: #949494;"># … with 22 more rows</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">tm_grid</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></code></pre></div>
<p><img src="tuning_files/figure-html/tm-autoplot-1.png" width="700"></p>
<p>We can select a parameter combination as the final configuration and update our model specification object with those values.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cubist_fit</span> <span class="op">&lt;-</span> 
  <span class="va">cubist_spec</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">finalize_model</span><span class="op">(</span><span class="fu">select_best</span><span class="op">(</span><span class="va">tm_grid</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">tm_train</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cubist_fit</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tm_test</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 6 × 1</span></span>
<span class="co">##   .pred</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> 0.723</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> 0.725</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> 0.720</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> 0.759</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> 0.744</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> 0.729</span></code></pre>
<p>This can be more easily done with <code>last_fit()</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cubist_results</span> <span class="op">&lt;-</span> 
  <span class="va">cubist_spec</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">finalize_model</span><span class="op">(</span><span class="fu">select_best</span><span class="op">(</span><span class="va">tm_grid</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">last_fit</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, split <span class="op">=</span> <span class="va">split</span><span class="op">)</span>

<span class="va">cubist_results</span></code></pre></div>
<pre><code><span class="co">## # Resampling results</span>
<span class="co">## # Manual resampling </span>
<span class="co">## <span style="color: #949494;"># A tibble: 1 × 6</span></span>
<span class="co">##   splits             id               .metrics .notes   .predictions .workflow </span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span>
<span class="co">## <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">&lt;split [2197/733]&gt;</span> train/test split &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;     <span style="color: #949494;">&lt;workflow&gt;</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># test set results:</span>
<span class="fu">collect_metrics</span><span class="op">(</span><span class="va">cubist_results</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 2 × 4</span></span>
<span class="co">##   .metric .estimator .estimate .config             </span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span>
<span class="co">## <span style="color: #BCBCBC;">1</span> rmse    standard     0.005<span style="text-decoration: underline;">76</span> Preprocessor1_Model1</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> rsq     standard     0.857   Preprocessor1_Model1</span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># test set predictions:</span>
<span class="fu">collect_predictions</span><span class="op">(</span><span class="va">cubist_results</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 733 × 5</span></span>
<span class="co">##    id               .pred  .row Sale_Price .config             </span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> train/test split 0.723     5      0.723 Preprocessor1_Model1</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> train/test split 0.725    10      0.722 Preprocessor1_Model1</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> train/test split 0.720    11      0.720 Preprocessor1_Model1</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> train/test split 0.760    16      0.758 Preprocessor1_Model1</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> train/test split 0.744    18      0.748 Preprocessor1_Model1</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> train/test split 0.730    20      0.726 Preprocessor1_Model1</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> train/test split 0.726    23      0.727 Preprocessor1_Model1</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> train/test split 0.708    27      0.708 Preprocessor1_Model1</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> train/test split 0.712    34      0.714 Preprocessor1_Model1</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> train/test split 0.744    37      0.746 Preprocessor1_Model1</span>
<span class="co">## <span style="color: #949494;"># … with 723 more rows</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Max Kuhn, Ross Quinlan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
